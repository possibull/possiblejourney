name: Update latest-version.json

on:
  push:
    tags:
      - 'v*'  # Trigger on version tags like v1.3.11

jobs:
  update-version:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        
      - name: Extract version from tag
        id: extract_version
        run: |
          # Remove 'v' prefix from tag (e.g., v1.3.11 -> 1.3.11)
          VERSION=${GITHUB_REF#refs/tags/v}
          echo "version=$VERSION" >> $GITHUB_OUTPUT
          
          # Extract major.minor and build number
          MAJOR_MINOR=$(echo $VERSION | cut -d. -f1,2)
          BUILD_NUMBER=$(echo $VERSION | cut -d. -f3)
          echo "major_minor=$MAJOR_MINOR" >> $GITHUB_OUTPUT
          echo "build_number=$BUILD_NUMBER" >> $GITHUB_OUTPUT
          
      - name: Update latest-version.json
        run: |
          cat > latest-version.json << EOF
          {
            "version": "${{ steps.extract_version.outputs.major_minor }}",
            "build": ${{ steps.extract_version.outputs.build_number }},
            "releaseNotes": "Enhanced User Experience & Performance - Improved UI/UX design and visual consistency - Enhanced app performance and responsiveness - Additional bug fixes and stability improvements - Better mobile experience and accessibility - Optimized data handling and storage - Improved user workflow and navigation - Enhanced feature reliability and consistency - Continued app improvements and refinements",
            "forceUpdate": false,
            "lastUpdated": "$(date -u +"%Y-%m-%dT%H:%M:%SZ")"
          }
          EOF
          
      - name: Commit and push changes
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git add latest-version.json
          git commit -m "Auto-update latest-version.json for ${{ steps.extract_version.outputs.version }}"
          git push 